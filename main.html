<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CrisisTrack</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <nav>
    <ul class="sidebar">
      <li onclick="hideSidebar()"><a href="#"><svg xmlns="http://www.w3.org/2000/svg" height="26px" viewBox="0 -960 960 960" width="26px" fill="#b91c1c"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></a></li>
      <li><a href="../Signup/signup.html">Signup</a></li>
      <li><a href="../Signup/login.html">Login</a></li>
      <li><a href="main.html">Home</a></li>
    </ul>
    <ul>
      <li class="logo">CrisisTrack</li>
      <li class="hideOnMobile"><a href="../Signup/signup.html">Signup</a></li>
      <li class="hideOnMobile"><a href="../Signup/login.html">Login</a></li>
      <li class="hideOnMobile"><a href="main.html">Home</a></li>
      <li class="menu-button" onclick="showSidebar()"><a href="#"><svg xmlns="http://www.w3.org/2000/svg" height="26px" viewBox="0 -960 960 960" width="26px" fill="#b91c1c"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg></a></li>
    </ul>
  </nav>

  <main>
    <section class="pain-log">
      <h2>Log Your Pain</h2>
      <textarea class="triggers" placeholder="Describe your pain today..."></textarea>
      <label for="pain-level">Pain Level (1 - Normal, 5 - Average, 10 - Excruciating)</label><br>
      <input class="range" type="range" id="pain-level" min="1" max="10" />
      <div class="scale-labels"><span>1</span><span>5</span><span>10</span></div>
      <button onclick="submitPainLog()">Submit Pain Log</button>
    </section>

    <section class="reminders">
      <h2>Reminders</h2>

      <div class="reminder-form">
        <label for="reminder-time">Date and Time</label>
        <input type="datetime-local" id="reminder-time" required>

        <label for="reminder-msg">Custom Message</label>
        <input type="text" id="reminder-msg" placeholder="E.g., Take meds" required>

        <label><input type="checkbox" id="repeat-daily"> Repeat Daily</label>

        <button onclick="setReminder()">Set Reminder</button>
        <button onclick="clearReminders()">Clear All</button>
        <button onclick="stopReminderSound()">Stop Sound</button>
      </div>

      <div id="sound-status" class="sound-status">
        ðŸ”Š Reminder Sound Playing...
      </div>

      <div id="reminder-list"></div>

      <audio id="reminder-sound" src="/audio/audioreminder.mp3" preload="auto"></audio>
    </section>

    <section class="panic">
      <button id="panic-btn">PANIC</button>
    </section>
  </main>

  <section id="caretaker">
    <h2>Caretaker Information</h2>
    <input type="text" placeholder="Name (required)" id="Name" class="input-field"> <br>
    <input type="tel" placeholder="Phone number (required)" id="phone" class="input-field"> <br>
    <input type="text" placeholder="Relationship" id="relative" class="input-field"><br>
    <button class="submit-button">Save</button>
    <button class="submit-button">Delete</button>
  </section>

  <section id="personal">
    <h2>Personal Health Status</h2>
    <fieldset>
      <legend>What triggers your crisis</legend>
      <textarea class="triggers" placeholder="What Triggers your crisis"></textarea>
    </fieldset>
    <fieldset>
      <legend>Sickle Cell type</legend>
      <label class="labels" for="SS">SS</label>
      <input type="radio" id="SS" name="sickle-cell" value="SS"/> <br>
      <label class="labels" for="SC">SC</label>
      <input type="radio" id="SC" name="sickle-cell" value="SC"/> <br>
    </fieldset>
    <fieldset>
      <legend>How often do you get crisis</legend>
      <label class="labels" for="Often">Often (within 2-4 months)</label>
      <input type="radio" id="Often" name="frequency" value="Often"/> <br>
      <label class="labels" for="Sometimes">Sometimes (within 5-12 months)</label>
      <input type="radio" id="Sometimes" name="frequency" value="Sometimes"/> <br>
      <label class="labels" for="Rarely">Rarely (once a year)</label>
      <input type="radio" id="Rarely" name="frequency" value="Rarely"/> <br>
    </fieldset>
    <button class="submit-button">Save</button>
    <button class="submit-button">Delete</button>
  </section>

  <section id="resources">
    <h2>Educational Resources</h2>
    <ul class="resource-link">
      <li><a href="https://www.nhlbi.nih.gov/health/sickle-cell-disease" target="_blank">Understanding Sickle Cell</a></li>
      <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC9175917/" target="_blank">Nutrition and Hydration for SCD</a></li>
      <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC1279994/" target="_blank">Managing Pain - Medical Guide</a></li>
    </ul>

    <div class="frame">
      <iframe width="300" height="200" src="https://www.youtube.com/embed/dJBmtPR_flg?si=Km92P7ogtbaeoCM4" title="What is sickle-cell disease" allowfullscreen></iframe>
      <iframe width="300" height="200" src="https://www.youtube.com/embed/qK5H9fPkltc?si=SexhpXeaGVA5SB4l" title="What you need to know about sickle-cell disease" allowfullscreen></iframe>
      <iframe width="300" height="200" src="https://www.youtube.com/embed/fIIJmg_1hv0?si=C_ZatNS-fErvsOf5" title="Overview of sickle-cell disease" allowfullscreen></iframe>
    </div>
  </section>

  <footer class="footer">
    <div class="footer-content">
      <p>&copy; 2025 Kolade Adepoju. All rights reserved.</p>
    </div>
  </footer>

  <script>
    function showSidebar() {
      const sidebar = document.querySelector('.sidebar');
      sidebar.style.display = 'flex';
    }
    function hideSidebar() {
      const sidebar = document.querySelector('.sidebar');
      sidebar.style.display = 'none';
    }

    const reminderList = document.getElementById('reminder-list');
    const reminderSound = document.getElementById('reminder-sound');
    const soundStatus = document.getElementById('sound-status');
    const reminders = [];

    if ('Notification' in window && Notification.permission !== 'granted') {
      Notification.requestPermission();
    }

    function setReminder() {
      const timeInput = document.getElementById('reminder-time').value;
      const message = document.getElementById('reminder-msg').value;
      const repeat = document.getElementById('repeat-daily').checked;

      if (!timeInput || !message) {
        alert("Please fill out all reminder fields.");
        return;
      }

      const reminderTime = new Date(timeInput);
      const now = new Date();

      if (reminderTime <= now) {
        alert("Please set a future time.");
        return;
      }

      const reminder = { time: reminderTime, message, repeat, alerted: false, pendingRemoval: false };
      reminders.push(reminder);
      displayReminder(reminder, reminders.length - 1);
    }

    function displayReminder(reminder, index) {
      const div = document.createElement('div');
      div.className = 'reminder-item';
      div.dataset.index = index;

      const text = document.createElement('span');
      text.innerText = `${reminder.time.toLocaleString()} - ${reminder.message}${reminder.repeat ? ' (Daily)' : ''}`;

      const delBtn = document.createElement('button');
      delBtn.innerText = 'Delete';
      delBtn.className = 'delete-btn';
      delBtn.onclick = () => {
        reminders.splice(index, 1);
        div.remove();
      };

      div.appendChild(text);
      div.appendChild(delBtn);
      reminderList.appendChild(div);
    }

    function clearReminders() {
      reminders.length = 0;
      reminderList.innerHTML = '';
    }

    function stopReminderSound() {
      reminderSound.pause();
      reminderSound.currentTime = 0;
      reminderSound.loop = false;
      updateSoundStatus(false);

      for (let i = reminders.length - 1; i >= 0; i--) {
        if (reminders[i].pendingRemoval) {
          reminderList.children[i]?.remove();
          reminders.splice(i, 1);
        }
      }
    }

    function updateSoundStatus(isPlaying) {
      soundStatus.style.display = 'block';
      soundStatus.innerText = isPlaying
        ? 'ðŸ”Š Reminder Sound Playing...'
        : 'âœ… Reminder Sound Stopped';
      if (!isPlaying) {
        setTimeout(() => (soundStatus.style.display = 'none'), 2000);
      }
    }

    setInterval(() => {
      const now = new Date();

      reminders.forEach((reminder, index) => {
        const timeDiff = reminder.time - now;

        if (timeDiff <= 60000 && timeDiff >= 0 && !reminder.alerted) {
          setTimeout(() => {
            triggerNotification(reminder.message);
            reminderSound.loop = true;
            reminderSound.play();
            updateSoundStatus(true);

            alert(`ðŸ”” Reminder: ${reminder.message}`);

            reminder.alerted = true;

            if (reminder.repeat) {
              reminder.time.setDate(reminder.time.getDate() + 1);
              reminder.alerted = false;
              displayReminder(reminder, index);
            } else {
              reminder.pendingRemoval = true;
            }
          }, timeDiff);
        }
      });
    }, 15000);

    function triggerNotification(message) {
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification("ðŸ”” Reminder", {
          body: message,
          icon: 'https://cdn-icons-png.flaticon.com/512/1828/1828884.png',
        });
      }

      reminderSound.play();
      updateSoundStatus(true);
    }
  </script>
</body>
</html>
